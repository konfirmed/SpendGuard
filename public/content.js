(()=>{"use strict";(new class{constructor(){this.cooldownActive=!1,this.interceptedButtons=new Set}init(){this.scanForCheckoutButtons(),this.observeChanges()}observeChanges(){new MutationObserver((()=>{this.cooldownActive||this.scanForCheckoutButtons()})).observe(document.body,{childList:!0,subtree:!0})}scanForCheckoutButtons(){this.isExcludedSite()||document.querySelectorAll([".checkout-button",".buy-button",".purchase-button",".add-to-cart",".cart-button",".proceed-button",'[data-testid*="checkout"]','[data-testid*="buy"]','[data-testid*="purchase"]','[data-testid*="add-to-cart"]',".single_add_to_cart_button","#buy-now-button",".shopify-payment-button",".SubmitButton",".paypal-button",'button[type="submit"]','input[type="submit"]'].join(",")).forEach((e=>{!this.interceptedButtons.has(e)&&this.isPurchaseButton(e)&&(this.interceptedButtons.add(e),this.addInterception(e))}))}isPurchaseButton(e){if(this.isExcludedSite())return!1;const t=(e.textContent||"").toLowerCase(),n=e.getAttribute("aria-label")?.toLowerCase()||"",o=e.className.toLowerCase(),i=e.id.toLowerCase(),r=["buy","purchase","checkout","order","pay","complete","add to cart","proceed","continue","place order","submit order"].some((e=>t.includes(e)||n.includes(e)||o.includes(e))),s=["cancel","back","return","edit","remove","delete","merge","commit","push","pull","fork","clone","create","new","save","update","submit pull","submit issue"].some((e=>t.includes(e)||n.includes(e)||o.includes(e)||i.includes(e))),c=this.isLikelyEcommercePage();return r&&!s&&c}isExcludedSite(){const e=window.location.hostname.toLowerCase();return["github.com","gitlab.com","bitbucket.org","stackoverflow.com","stackexchange.com","reddit.com","twitter.com","x.com","facebook.com","instagram.com","linkedin.com","youtube.com","google.com","microsoft.com","apple.com","developer.mozilla.org","docs.google.com","notion.so","slack.com","discord.com","zoom.us"].some((t=>e.includes(t)))}isLikelyEcommercePage(){const e=window.location.href.toLowerCase(),t=window.location.hostname.toLowerCase(),n=["/checkout","/cart","/buy","/purchase","/order","/payment","shop","store","market","commerce","retail"].some((n=>e.includes(n)||t.includes(n))),o=null!==document.querySelector(".price, .product-price, .amount, [data-price]"),i=null!==document.querySelector(".cart, .shopping-cart, .basket");return n||o||i}addInterception(e){e.addEventListener("click",(async t=>{t.preventDefault(),t.stopPropagation();const n=await this.getSettings(),o=this.extractSimpleContext();await this.recordIntercept(o),this.showCooldown(n.cooldownSeconds,(()=>{this.proceedWithClick(e)}))}),!0)}extractSimpleContext(){const e={},t=["h1",".product-title",".product-name","#productTitle"];for(const n of t){const t=document.querySelector(n);if(t?.textContent?.trim()){e.productName=t.textContent.trim();break}}const n=[".price",".product-price",".amount","[data-price]"];for(const t of n){const n=document.querySelector(t);if(n?.textContent?.trim()){const t=n.textContent.match(/[\$€£¥]?\s*(\d+(?:,\d{3})*(?:\.\d{2})?)/);if(t){e.priceText=n.textContent.trim(),e.price=parseFloat(t[1].replace(/,/g,""));break}}}return e}showCooldown(e,t){this.cooldownActive=!0;const n=document.createElement("div");n.id="spendguard-cooldown-overlay",n.innerHTML=`\n      <div style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0, 0, 0, 0.8);\n        z-index: 999999;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      ">\n        <div style="\n          background: white;\n          border-radius: 12px;\n          padding: 2rem;\n          max-width: 400px;\n          width: 90%;\n          text-align: center;\n          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n        ">\n          <div style="\n            width: 48px;\n            height: 48px;\n            background: #dbeafe;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin: 0 auto 1.5rem auto;\n          ">\n            <svg width="24" height="24" fill="#2563eb" viewBox="0 0 24 24">\n              <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n            </svg>\n          </div>\n          \n          <h2 style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: 700; color: #111827;">\n            Take a Moment\n          </h2>\n          \n          <p style="margin: 0 0 1.5rem 0; color: #6b7280; line-height: 1.5;">\n            Before completing this purchase, let's pause and reflect. Is this something you really need right now?\n          </p>\n          \n          <div style="margin-bottom: 1.5rem;">\n            <div id="countdown" style="\n              font-size: 3rem;\n              font-weight: 700;\n              color: #2563eb;\n              font-family: ui-monospace, SFMono-Regular, monospace;\n              margin-bottom: 0.75rem;\n            ">${e}</div>\n            \n            <div style="\n              width: 100%;\n              height: 8px;\n              background: #e5e7eb;\n              border-radius: 4px;\n              overflow: hidden;\n            ">\n              <div id="progress-bar" style="\n                height: 100%;\n                background: #2563eb;\n                width: 0%;\n                transition: width 1s linear;\n                border-radius: 4px;\n              "></div>\n            </div>\n          </div>\n          \n          <div style="\n            background: #f3f4f6;\n            padding: 1rem;\n            border-radius: 8px;\n            margin-bottom: 1.5rem;\n            text-align: left;\n          ">\n            <p style="margin: 0 0 0.5rem 0; font-weight: 600; color: #374151; font-size: 0.875rem;">\n              Consider:\n            </p>\n            <ul style="margin: 0; padding-left: 1rem; color: #6b7280; font-size: 0.875rem; line-height: 1.4;">\n              <li>Do I have a specific need for this item?</li>\n              <li>Can I wait 24 hours to decide?</li>\n              <li>Is this within my budget?</li>\n              <li>Have I compared alternatives?</li>\n            </ul>\n          </div>\n          \n          <div style="display: flex; gap: 0.75rem; flex-direction: column;">\n            <button id="skip-btn" style="\n              background: #d1d5db;\n              color: #374151;\n              border: none;\n              padding: 0.75rem 1rem;\n              border-radius: 6px;\n              font-weight: 500;\n              cursor: pointer;\n              transition: background-color 0.2s;\n              display: none;\n            ">\n              Proceed Anyway\n            </button>\n            \n            <button id="wait-btn" style="\n              background: #059669;\n              color: white;\n              border: none;\n              padding: 0.75rem 1rem;\n              border-radius: 6px;\n              font-weight: 500;\n              cursor: pointer;\n              transition: background-color 0.2s;\n            ">\n              Take More Time to Decide\n            </button>\n          </div>\n          \n          <p style="margin: 1rem 0 0 0; color: #9ca3af; font-size: 0.75rem;">\n            This pause is brought to you by SpendGuard\n          </p>\n        </div>\n      </div>\n    `,document.body.appendChild(n);const o=n.querySelector("#countdown"),i=n.querySelector("#progress-bar"),r=n.querySelector("#skip-btn"),s=n.querySelector("#wait-btn");let c=e,d=!1;setTimeout((()=>{d=!0,r.style.display="block"}),Math.min(5e3,1e3*e));const a=setInterval((()=>{c--,o.textContent=this.formatTime(c);const t=(e-c)/e*100;i.style.width=`${t}%`,c<=0&&(clearInterval(a),r.textContent="Continue Purchase",r.style.background="#059669",r.style.color="white")}),1e3);r.addEventListener("click",(()=>{(c<=0||d)&&(this.removeCooldown(n),t())})),s.addEventListener("click",(()=>{this.removeCooldown(n)})),r.addEventListener("mouseenter",(()=>{r.style.background=c<=0?"#047857":"#9ca3af"})),r.addEventListener("mouseleave",(()=>{r.style.background=c<=0?"#059669":"#d1d5db"})),s.addEventListener("mouseenter",(()=>{s.style.background="#047857"})),s.addEventListener("mouseleave",(()=>{s.style.background="#059669"}))}formatTime(e){if(e<=0)return"0:00";const t=Math.floor(e/60),n=e%60;return t>0?`${t}:${n.toString().padStart(2,"0")}`:n.toString()}removeCooldown(e){e.style.opacity="0",e.style.transition="opacity 0.3s ease",setTimeout((()=>{e.remove(),this.cooldownActive=!1}),300)}proceedWithClick(e){this.recordProceed(),this.interceptedButtons.delete(e);const t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(t)}async getSettings(){return new Promise((e=>{chrome.runtime.sendMessage({action:"getSettings"},(t=>{e(t?.settings||{cooldownSeconds:30,enableNudges:!0,enableScamDetection:!0})}))}))}async recordIntercept(e){chrome.runtime.sendMessage({action:"addPurchase",purchase:{url:window.location.href,timestamp:Date.now(),intercepted:!0,proceeded:!1,amount:e.price}}),chrome.runtime.sendMessage({action:"incrementIntercepts"})}recordProceed(){chrome.runtime.sendMessage({action:"addPurchase",purchase:{url:window.location.href,timestamp:Date.now(),intercepted:!0,proceeded:!0}})}}).init(),window.addEventListener("beforeunload",(()=>{}))})();